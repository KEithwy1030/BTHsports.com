# 本地开发指南

## 快速开始

### 1. 启动开发环境

```bash
# 方式1：一键启动前后端（推荐）
npm run dev

# 方式2：分别启动
# 终端1
npm run server:dev

# 终端2
npm run client:dev
```

### 2. 访问应用

- **前端地址**: http://localhost:7000
- **后端API**: http://localhost:7001
- **API健康检查**: http://localhost:7001/health

---

## 开发配置说明

### 环境变量配置

项目使用 `env.dev` 文件作为开发环境配置。

**位置**: 项目根目录 `env.dev`

**重要配置项**：
- `PORT`: 后端服务端口（默认7001）
- `REDIS_HOST`: Redis地址（默认localhost）
- `REDIS_PORT`: Redis端口（默认6379）

### 热重载配置

**后端热重载**：
- 使用 `nodemon` 监听 `server/` 目录
- 修改 `.js` 文件会自动重启服务
- 修改 `package.json` 需要手动重启

**前端热重载**：
- 使用 `Vite` HMR功能
- 修改 `client/src/` 下的文件会自动刷新
- 修改 `vite.config.js` 需要手动重启

---

## 本地服务要求

### 必需服务

1. **Node.js 20+**
   - 检查版本：`node -v`
   - 下载：https://nodejs.org/

2. **Chrome浏览器**（用于puppeteer-core）
   - 代码中已配置Windows默认路径
   - 如路径不同，需要修改 `server/crawler/StreamCrawler.js`

### 可选服务

1. **Redis**（用于缓存）
   - 如果本地没有Redis，可以：
     - 使用Docker单独运行：`docker run -d -p 6379:6379 redis:alpine`
     - 或注释掉Redis相关代码

2. **MySQL**（用于数据存储）
   - 如果不需要数据库存储，可以：
     - 使用内存缓存
     - 或注释掉数据库相关代码

---

## 开发工作流

### 1. 代码修改流程

```
修改代码 → 自动热重载 → 浏览器自动刷新（前端）/ 服务自动重启（后端）
```

### 2. 调试技巧

**后端调试**：
- 使用 `console.log()` 输出日志
- 使用VS Code/Cursor断点调试
- 查看控制台输出

**前端调试**：
- 使用浏览器开发者工具
- Vue DevTools插件
- 查看浏览器控制台

### 3. 爬虫测试

**测试爬虫功能**：
```bash
# 启动后端服务
npm run server:dev

# 在浏览器或Postman中测试API
# GET http://localhost:7001/api/matches
# POST http://localhost:7001/api/crawler/trigger
```

**注意事项**：
- 爬虫需要网络连接
- 某些目标网站可能有反爬虫限制
- 建议控制请求频率，避免被封禁

---

## 常见问题

### 1. 端口被占用

**问题**：`Error: listen EADDRINUSE: address already in use :::7000`

**解决**：
```bash
# Windows查看端口占用
netstat -ano | findstr :7000

# 杀死占用端口的进程
taskkill /PID <进程ID> /F

# 或修改端口（在vite.config.js和env.dev中）
```

### 2. 前端无法连接后端

**问题**：前端代理配置错误

**解决**：
- 检查 `client/vite.config.js` 中的proxy配置
- 确保后端服务正在运行（http://localhost:7001）
- 检查CORS配置（`server/index.js`）

### 3. 爬虫功能异常

**问题**：网络请求失败或超时

**解决**：
- 检查网络连接
- 检查目标网站是否可访问
- 查看控制台错误日志
- 检查User-Agent和请求头配置

### 4. Redis连接失败

**问题**：`Error: connect ECONNREFUSED`

**解决**：
- 确保Redis服务正在运行
- 检查 `env.dev` 中的Redis配置
- 如果不需要Redis，可以注释相关代码

---

## 开发最佳实践

1. **代码规范**
   - 使用ESLint检查代码
   - 保持代码风格一致
   - 及时清理调试代码

2. **版本控制**
   - 不要提交 `node_modules/`
   - 不要提交 `env.dev`（包含敏感信息）
   - 使用 `.gitignore` 过滤不需要的文件

3. **性能优化**
   - 控制爬虫请求频率
   - 使用缓存减少重复请求
   - 优化数据库查询

4. **错误处理**
   - 添加完善的错误处理
   - 记录详细的错误日志
   - 提供友好的错误提示

---

## 项目结构

```
Live_show/
├── client/          # 前端代码（Vue 3）
│   ├── src/         # 源代码
│   ├── public/      # 静态资源
│   └── vite.config.js
├── server/          # 后端代码（Node.js）
│   ├── crawler/     # 爬虫模块
│   ├── routes/      # 路由
│   ├── services/    # 服务
│   └── index.js     # 入口文件
├── env.dev          # 开发环境配置
├── package.json     # 项目配置
└── README.md        # 项目说明
```

---

## 技术支持

如遇到问题，请：
1. 查看控制台错误日志
2. 检查环境变量配置
3. 确认所有服务正常运行
4. 查看项目文档

---

**最后更新**: 2025-01-XX  
**开发环境**: 本地开发模式

